-- Тестовые данные для справочника организаций
-- Здания в радиусе ~100 км от Москвы

-- Очистка существующих данных (опционально)
-- TRUNCATE TABLE organization_activities, organization_phones, organizations, activities, buildings RESTART IDENTITY CASCADE;

-- 1. Вставляем здания в радиусе ~100 км от центра Москвы
INSERT INTO buildings (id, address, point) VALUES
    -- Центр Москвы (0-10 км)
    (1, 'г. Москва, Красная площадь, 1', ST_GeomFromText('POINT(37.6173 55.7558)', 4326)),
    (2, 'г. Москва, ул. Тверская, 13', ST_GeomFromText('POINT(37.6022 55.7612)', 4326)),
    (3, 'г. Москва, пр-т Мира, 101', ST_GeomFromText('POINT(37.6332 55.7934)', 4326)),
    (4, 'г. Москва, ул. Новый Арбат, 15', ST_GeomFromText('POINT(37.5833 55.7522)', 4326)),

    -- Ближнее Подмосковье (10-30 км)
    (5, 'г. Химки, ул. Московская, 15', ST_GeomFromText('POINT(37.4333 55.8977)', 4326)),
    (6, 'г. Балашиха, ш. Энтузиастов, 1', ST_GeomFromText('POINT(37.9500 55.8000)', 4326)),
    (7, 'г. Мытищи, ул. Мира, 25', ST_GeomFromText('POINT(37.7167 55.9167)', 4326)),
    (8, 'г. Подольск, ул. Кирова, 42', ST_GeomFromText('POINT(37.5500 55.4333)', 4326)),

    -- Среднее Подмосковье (30-70 км)
    (9, 'г. Сергиев Посад, пр-т Красной Армии, 10', ST_GeomFromText('POINT(38.1333 56.3000)', 4326)),
    (10, 'г. Коломна, ул. Октябрьской Революции, 5', ST_GeomFromText('POINT(38.7667 55.0833)', 4326)),
    (11, 'г. Звенигород, ул. Московская, 8', ST_GeomFromText('POINT(36.8500 55.7333)', 4326)),
    (12, 'г. Дмитров, ул. Загорская, 15', ST_GeomFromText('POINT(37.5167 56.3500)', 4326)),

    -- Дальнее Подмосковье (70-100+ км)
    (13, 'г. Тверь, ул. Советская, 25', ST_GeomFromText('POINT(35.9167 56.8580)', 4326)),
    (14, 'г. Калуга, ул. Ленина, 1', ST_GeomFromText('POINT(36.2667 54.5333)', 4326)),
    (15, 'г. Владимир, ул. Большая Московская, 20', ST_GeomFromText('POINT(40.4000 56.1280)', 4326)),
    (16, 'г. Рязань, ул. Ленина, 30', ST_GeomFromText('POINT(39.7333 54.6167)', 4326));

-- 2. Вставляем виды деятельности (дерево до 3 уровней)
INSERT INTO activities (id, name, parent_id) VALUES
    -- Уровень 1
    (1, 'Еда', NULL),
    (2, 'Автомобили', NULL),
    (3, 'Электроника', NULL),
    (4, 'Одежда', NULL),
    (5, 'Строительство', NULL),

    -- Уровень 2 - Еда
    (6, 'Мясная продукция', 1),
    (7, 'Молочная продукция', 1),
    (8, 'Бакалея', 1),
    (9, 'Овощи и фрукты', 1),
    (10, 'Напитки', 1),

    -- Уровень 2 - Автомобили
    (11, 'Грузовые', 2),
    (12, 'Легковые', 2),
    (13, 'Запчасти', 2),
    (14, 'Аксессуары', 2),
    (15, 'Шины и диски', 2),

    -- Уровень 2 - Электроника
    (16, 'Смартфоны', 3),
    (17, 'Компьютеры', 3),
    (18, 'Бытовая техника', 3),
    (19, 'Телевизоры', 3),

    -- Уровень 3 - Мясная продукция
    (20, 'Колбасы', 6),
    (21, 'Полуфабрикаты', 6),
    (22, 'Свежее мясо', 6),

    -- Уровень 3 - Молочная продукция
    (23, 'Сыры', 7),
    (24, 'Йогурты', 7),
    (25, 'Молоко', 7),
    (26, 'Сметана и творог', 7),

    -- Уровень 3 - Запчасти
    (27, 'Двигатели', 13),
    (28, 'Тормозные системы', 13),
    (29, 'Электрооборудование', 13),
    (30, 'Кузовные детали', 13);

-- 3. Вставляем организации
INSERT INTO organizations (id, name, building_id) VALUES
    (1, 'ООО "Рога и Копыта"', 1),
    (2, 'ИП Иванов "Мясные Дела"', 2),
    (3, 'ЗАО "Молочные Реки"', 3),
    (4, 'Автоцентр "Скорость"', 4),
    (5, 'Магазин "Электронный Рай"', 5),
    (6, 'Супермаркет "Продуктовый"', 6),
    (7, 'Автозапчасти "Деталька"', 7),
    (8, 'Салон "Модная Одежда"', 8),
    (9, 'Строймаркет "Мастерок"', 9),
    (10, 'Кафе "Вкусная Еда"', 10),
    (11, 'Автосалон "Престиж"', 11),
    (12, 'Техноцентр "Гаджет"', 12),
    (13, 'Мясной цех "Деревенский"', 13),
    (14, 'Молочная ферма "Лужайка"', 14),
    (15, 'Продуктовый склад "Оптовик"', 15),
    (16, 'Автомагазин "За рулем"', 16);

-- 4. Вставляем телефоны организаций
INSERT INTO organization_phones (id, organization_id, phone) VALUES
    (1, 1, '8-495-111-11-11'),
    (2, 1, '8-495-111-11-12'),
    (3, 2, '8-495-222-22-22'),
    (4, 3, '8-495-333-33-33'),
    (5, 3, '8-495-333-33-34'),
    (6, 4, '8-495-444-44-44'),
    (7, 4, '8-495-444-44-45'),
    (8, 5, '8-495-555-55-55'),
    (9, 6, '8-495-666-66-66'),
    (10, 7, '8-495-777-77-77'),
    (11, 8, '8-495-888-88-88'),
    (12, 9, '8-495-999-99-99'),
    (13, 10, '8-496-111-11-11'),
    (14, 11, '8-496-222-22-22'),
    (15, 12, '8-496-333-33-33'),
    (16, 13, '8-482-111-11-11'),
    (17, 14, '8-484-111-11-11'),
    (18, 15, '8-491-111-11-11'),
    (19, 16, '8-491-222-22-22');

-- 5. Связываем организации с видами деятельности
INSERT INTO organization_activities (id, organization_id, activity_id) VALUES
    -- ООО "Рога и Копыта" - разнообразная деятельность
    (1, 1, 1), (2, 1, 6), (3, 1, 7), (4, 1, 8),

    -- ИП Иванов - специализация на мясе
    (5, 2, 6), (6, 2, 20), (7, 2, 21), (8, 2, 22),

    -- ЗАО "Молочные Реки" - специализация на молочке
    (9, 3, 7), (10, 3, 23), (11, 3, 24), (12, 3, 25),

    -- Автоцентр "Скорость" - автомобили широко
    (13, 4, 2), (14, 4, 12), (15, 4, 13), (16, 4, 14),

    -- Магазин "Электронный Рай" - электроника
    (17, 5, 3), (18, 5, 16), (19, 5, 17), (20, 5, 18),

    -- Супермаркет "Продуктовый" - все продукты
    (21, 6, 1), (22, 6, 6), (23, 6, 7), (24, 6, 8), (25, 6, 9),

    -- Автозапчасти "Деталька" - узкая специализация
    (26, 7, 13), (27, 7, 27), (28, 7, 28), (29, 7, 29),

    -- Салон "Модная Одежда" - одежда
    (30, 8, 4),

    -- Строймаркет "Мастерок" - строительство
    (31, 9, 5),

    -- Кафе "Вкусная Еда" - еда и напитки
    (32, 10, 1), (33, 10, 10),

    -- Автосалон "Престиж" - легковые авто
    (34, 11, 2), (35, 11, 12), (36, 11, 14),

    -- Техноцентр "Гаджет" - электроника
    (37, 12, 3), (38, 12, 16), (39, 12, 19),

    -- Мясной цех "Деревенский" - мясо
    (40, 13, 6), (41, 13, 22),

    -- Молочная ферма "Лужайка" - молочка
    (42, 14, 7), (43, 14, 25), (44, 14, 26),

    -- Продуктовый склад "Оптовик" - бакалея
    (45, 15, 1), (46, 15, 8),

    -- Автомагазин "За рулем" - автоаксессуары
    (47, 16, 2), (48, 16, 14), (49, 16, 15);

-- Проверочные запросы (можно выполнить отдельно)
/*
-- Проверка количества записей
SELECT 'buildings' as table_name, COUNT(*) FROM buildings
UNION ALL SELECT 'activities', COUNT(*) FROM activities
UNION ALL SELECT 'organizations', COUNT(*) FROM organizations
UNION ALL SELECT 'organization_phones', COUNT(*) FROM organization_phones
UNION ALL SELECT 'organization_activities', COUNT(*) FROM organization_activities;

-- Проверка расстояний от центра Москвы
SELECT
    id,
    address,
    ST_Distance(
        point::geography,
        ST_GeomFromText('POINT(37.6173 55.7558)', 4326)::geography
    ) / 1000 as distance_km
FROM buildings
ORDER BY distance_km;

-- Проверка дерева деятельностей
WITH RECURSIVE activity_tree AS (
    SELECT id, name, parent_id, 1 as level
    FROM activities
    WHERE parent_id IS NULL
    UNION ALL
    SELECT a.id, a.name, a.parent_id, at.level + 1
    FROM activities a
    JOIN activity_tree at ON a.parent_id = at.id
    WHERE at.level < 3
)
SELECT
    id,
    name,
    parent_id,
    level,
    repeat('  ', level - 1) || name as tree_view
FROM activity_tree
ORDER BY level, parent_id, name;
*/

-- SELECT
--     ST_Distance(
--         ST_GeomFromText('POINT(37.6173 55.7558)')::geography,
--         ST_GeomFromText('POINT(39.7333 54.6167)')::geography
--     ) / 1000 as distance_km;
